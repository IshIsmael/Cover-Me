<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/admin.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Southgate LC</h2>
                <p>Admin Panel</p>
            </div>
            
            <nav class="sidebar-nav">
                <ul>
                    <li>
                        <a href="/admin/dashboard" class="nav-link">
                            <span class="nav-icon">üìä</span>
                            <span class="nav-text">Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="/admin/cover" class="nav-link active">
                            <span class="nav-icon">üìã</span>
                            <span class="nav-text">Your Cover</span>
                        </a>
                    </li>
                    <li>
                        <a href="/admin/get-cover" class="nav-link">
                            <span class="nav-icon">‚ûï</span>
                            <span class="nav-text">Get Cover</span>
                        </a>
                    </li>
                    <li>
                        <a href="/admin/instructors" class="nav-link">
                            <span class="nav-icon">üë•</span>
                            <span class="nav-text">Instructors</span>
                        </a>
                    </li>
                    <li>
                        <a href="/admin/timetable" class="nav-link">
                            <span class="nav-icon">üìÖ</span>
                            <span class="nav-text">Timetable</span>
                        </a>
                    </li>
                </ul>
            </nav>
            
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">
                        <%= user.profile.firstName.charAt(0) %><%= user.profile.lastName.charAt(0) %>
                    </div>
                    <div class="user-details">
                        <div class="user-name"><%= user.profile.firstName %> <%= user.profile.lastName %></div>
                        <div class="user-role">Administrator</div>
                    </div>
                </div>
                <a href="/auth/logout" class="logout-btn">Sign Out</a>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Top Header -->
            <header class="content-header">
                <div class="header-left">
                    <h1 class="page-title">Your Cover</h1>
                    <p class="page-subtitle">Manage and track all cover requests</p>
                </div>
                <div class="header-right">
                    <a href="/admin/get-cover" class="btn btn-primary">
                        ‚ûï Create New Request
                    </a>
                </div>
            </header>

            <!-- Flash Messages -->
            <div class="flash-messages">
                <% if (error_msg && error_msg.length > 0) { %>
                    <div class="alert alert-error">
                        <span class="alert-icon">‚ö†Ô∏è</span>
                        <span class="alert-text"><%= error_msg %></span>
                        <button class="alert-close" onclick="this.parentElement.style.display='none'">√ó</button>
                    </div>
                <% } %>

                <% if (success_msg && success_msg.length > 0) { %>
                    <div class="alert alert-success">
                        <span class="alert-icon">‚úÖ</span>
                        <span class="alert-text"><%= success_msg %></span>
                        <button class="alert-close" onclick="this.parentElement.style.display='none'">√ó</button>
                    </div>
                <% } %>
            </div>

            <!-- Page Content -->
            <div class="page-content">
                <!-- Summary Stats -->
                <div class="grid grid-4">
                    <div class="stat-card stat-warning">
                        <div class="stat-icon">‚è≥</div>
                        <div class="stat-content">
                            <div class="stat-number"><%= stats.open %></div>
                            <div class="stat-label">Open Requests</div>
                        </div>
                    </div>
                    <div class="stat-card stat-pending">
                        <div class="stat-icon">‚úã</div>
                        <div class="stat-content">
                            <div class="stat-number"><%= stats.accepted %></div>
                            <div class="stat-label">Awaiting Confirmation</div>
                        </div>
                    </div>
                    <div class="stat-card stat-success">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-content">
                            <div class="stat-number"><%= stats.confirmed %></div>
                            <div class="stat-label">Confirmed</div>
                        </div>
                    </div>
                    <div class="stat-card stat-info">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-content">
                            <div class="stat-number"><%= stats.total %></div>
                            <div class="stat-label">Total Active</div>
                        </div>
                    </div>
                </div>

                <!-- Accepted Cover Requests (Need Confirmation) -->
                <% if (acceptedRequests.length > 0) { %>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">‚ö†Ô∏è Awaiting Your Confirmation</h3>
                            <p class="card-subtitle">Instructors have accepted these requests - confirm to finalize</p>
                        </div>
                        <div class="card-body">
                            <div class="cover-list">
                                <% acceptedRequests.forEach(function(request) { %>
                                    <div class="cover-item urgency-<%= request.urgency %>">
                                        <div class="cover-main">
                                            <div class="cover-header">
                                                <div class="cover-session">
                                                    <span class="session-name"><%= request.session.className %></span>
                                                    <span class="urgency-badge <%= request.urgency %>">
                                                        <%= request.urgency %>
                                                    </span>
                                                </div>
                                                <div class="cover-date">
                                                    <%= new Date(request.coverDate).toLocaleDateString('en-GB', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' }) %>
                                                </div>
                                            </div>
                                            <div class="cover-details">
                                                <span class="detail-item">üïê <%= request.session.startTime %> - <%= request.session.endTime %></span>
                                                <span class="detail-item">üìç <%= request.session.venue %></span>
                                                <% if (request.acceptedBy) { %>
                                                    <span class="detail-item">üë§ Accepted by: <strong><%= request.acceptedBy.profile.firstName %> <%= request.acceptedBy.profile.lastName %></strong></span>
                                                <% } %>
                                                <% if (request.reason) { %>
                                                    <span class="detail-item">üí¨ <%= request.reason %></span>
                                                <% } %>
                                            </div>
                                        </div>
                                        <div class="cover-actions">
                                            <form action="/admin/cover/<%= request._id %>/confirm" method="POST" style="display: inline;">
                                                <button type="submit" class="btn btn-sm btn-success">
                                                    ‚úì Confirm
                                                </button>
                                            </form>
                                            <form action="/admin/cover/<%= request._id %>/decline" method="POST" style="display: inline;">
                                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Decline this acceptance? The request will reopen to other instructors.')">
                                                    ‚úï Decline
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                <% }); %>
                            </div>
                        </div>
                    </div>
                <% } %>

                <!-- Open Cover Requests -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Open Requests</h3>
                        <p class="card-subtitle">Waiting for instructors to accept</p>
                    </div>
                    <div class="card-body">
                        <% if (openRequests.length === 0) { %>
                            <div class="empty-state">
                                <div class="empty-state-icon">üì≠</div>
                                <div class="empty-state-text">No open cover requests</div>
                            </div>
                        <% } else { %>
                            <div class="cover-list">
                                <% openRequests.forEach(function(request) { %>
                                    <div class="cover-item urgency-<%= request.urgency %>">
                                        <div class="cover-main">
                                            <div class="cover-header">
                                                <div class="cover-session">
                                                    <span class="session-name"><%= request.session.className %></span>
                                                    <span class="urgency-badge <%= request.urgency %>">
                                                        <%= request.urgency %>
                                                    </span>
                                                </div>
                                                <div class="cover-date">
                                                    <%= new Date(request.coverDate).toLocaleDateString('en-GB', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' }) %>
                                                </div>
                                            </div>
                                            <div class="cover-details">
                                                <span class="detail-item">üïê <%= request.session.startTime %> - <%= request.session.endTime %></span>
                                                <span class="detail-item">üìç <%= request.session.venue %></span>
                                                <span class="detail-item">üìß Notified <%= request.notificationsSent.length %> instructor(s)</span>
                                                <% if (request.reason) { %>
                                                    <span class="detail-item">üí¨ <%= request.reason %></span>
                                                <% } %>
                                            </div>
                                        </div>
                                        <div class="cover-actions">
                                            <form action="/admin/cover/<%= request._id %>/cancel" method="POST" style="display: inline;">
                                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Cancel this cover request?')">
                                                    Cancel
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                <% }); %>
                            </div>
                        <% } %>
                    </div>
                </div>

                <!-- Confirmed Cover Requests -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Confirmed</h3>
                        <p class="card-subtitle">Cover secured - instructors confirmed</p>
                    </div>
                    <div class="card-body">
                        <% if (confirmedRequests.length === 0) { %>
                            <div class="empty-state">
                                <div class="empty-state-icon">‚úÖ</div>
                                <div class="empty-state-text">No confirmed cover requests yet</div>
                            </div>
                        <% } else { %>
                            <div class="cover-list">
                                <% confirmedRequests.forEach(function(request) { %>
                                    <div class="cover-item confirmed">
                                        <div class="cover-main">
                                            <div class="cover-header">
                                                <div class="cover-session">
                                                    <span class="session-name"><%= request.session.className %></span>
                                                    <span class="status-badge status-confirmed">Confirmed</span>
                                                </div>
                                                <div class="cover-date">
                                                    <%= new Date(request.coverDate).toLocaleDateString('en-GB', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' }) %>
                                                </div>
                                            </div>
                                            <div class="cover-details">
                                                <span class="detail-item">üïê <%= request.session.startTime %> - <%= request.session.endTime %></span>
                                                <span class="detail-item">üìç <%= request.session.venue %></span>
                                                <% if (request.acceptedBy) { %>
                                                    <span class="detail-item">üë§ <strong><%= request.acceptedBy.profile.firstName %> <%= request.acceptedBy.profile.lastName %></strong></span>
                                                <% } %>
                                            </div>
                                        </div>
                                        <div class="cover-status">
                                            <div class="status-icon">‚úÖ</div>
                                        </div>
                                    </div>
                                <% }); %>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="/js/admin.js"></script>

    <style>
    /* Cover-specific styles */
    .cover-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .cover-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        background: white;
        border-radius: 8px;
        border-left: 4px solid #e2e8f0;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        transition: box-shadow 0.2s ease;
    }

    .cover-item:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .cover-item.urgency-urgent {
        border-left-color: #dc3545;
        background: #fff5f5;
    }

    .cover-item.urgency-normal {
        border-left-color: #ffc107;
    }

    .cover-item.urgency-advance_planned {
        border-left-color: #28a745;
    }

    .cover-item.confirmed {
        border-left-color: #28a745;
        opacity: 0.9;
    }

    .cover-main {
        flex: 1;
    }

    .cover-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }

    .cover-session {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .session-name {
        font-weight: 600;
        font-size: 16px;
        color: #1a202c;
    }

    .cover-date {
        font-size: 14px;
        color: #6c757d;
        font-weight: 500;
    }

    .urgency-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .urgency-badge.urgent {
        background-color: #dc3545;
        color: white;
    }

    .urgency-badge.normal {
        background-color: #ffc107;
        color: #856404;
    }

    .urgency-badge.advance_planned {
        background-color: #28a745;
        color: white;
    }

    .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .status-badge.status-confirmed {
        background-color: #d4f6d9;
        color: #0f5132;
    }

    .cover-details {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        font-size: 14px;
        color: #495057;
    }

    .detail-item {
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .cover-actions {
        display: flex;
        gap: 8px;
        flex-shrink: 0;
        margin-left: 20px;
    }

    .cover-status {
        display: flex;
        align-items: center;
        margin-left: 20px;
    }

    .status-icon {
        font-size: 32px;
    }

    /* Stat cards */
    .stat-card {
        background: white;
        border-radius: 12px;
        padding: 28px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border-left: 4px solid #e2e8f0;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    }

    .stat-card.stat-pending {
        border-left-color: #ffc107;
    }

    .stat-card.stat-success {
        border-left-color: #28a745;
    }

    .stat-card.stat-warning {
        border-left-color: #fd7e14;
    }

    .stat-card.stat-info {
        border-left-color: #17a2b8;
    }

    .stat-icon {
        font-size: 24px;
        margin-bottom: 16px;
        display: block;
    }

    .stat-number {
        font-size: 36px;
        font-weight: 700;
        color: #1a202c;
        line-height: 1;
        margin-bottom: 4px;
    }

    .stat-label {
        font-size: 14px;
        color: #6c757d;
        font-weight: 500;
    }

    /* Responsive */
    @media (max-width: 1024px) {
        .cover-item {
            flex-direction: column;
            align-items: flex-start;
        }

        .cover-actions {
            width: 100%;
            margin-left: 0;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e2e8f0;
        }

        .cover-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
        }
    }
    </style>
</body>
</html>